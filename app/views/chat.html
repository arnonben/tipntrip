<div class="row">
	<p class="alert alert-danger" ng-show="err">{{err}}</p>

</div>
<div class="row">
	<div class="chat-wrapper">
		<div class="col-lg-4">
			<aside class="chat-list-wrapper">
				<header class="chat-list-header">
					<div class="form-group text-right">
						<button class="btn btn-xs btn-default pull-right1">New Chat <i class="fa fa-comment-o"></i></button>
					</div>
					<input class="form-control input-sm" placeholder="Search" ng-model="search">
				</header>

				<div class="chat-list">
					<div ng-repeat="chat in chats | reverse " ng-click="$parent.selectChat(chat.$id);" ng-class="{'selected':$parent.selected==chat.$id}" ng-init="$index==0 && !$parent.selected && $parent.selectChat(chat.$id)">
						<div class="media chat">
							<div class="media-left">
								<img class="media-object chat-author-img" alt="{{users[chat_metas[chat.$id].user].name}}" style="width: 35px; height: 35px;" ng-src="https://placeholdit.imgix.net/~text?txtsize=24&bg=f27373&txtclr=ffffff&txt={{ users[chat_metas[chat.$id].user].first_name | limitTo:1 | uppercase }}&w=50&h=50">
							</div>
							<div class="media-body">
								<div class="chat-author-name">
									{{users[chat_metas[chat.$id].user].first_name | capitalize}} {{users[chat_metas[chat.$id].user].last_name | capitalize}}
								</div>
								<span class="chat-last-message">
									&nbsp;{{chat_metas[chat.$id].lastMessage.text | limitTo:20}}
								</span>
								<span class="chat-timestamp pull-right">
									&nbsp;{{chat_metas[chat.$id].lastMessage.createdAt | date:'shortTime'}}
								</span>
								
							</div>
						</div>
					</div>
				</div>
			</aside>
		</div>
		<div class="col-lg-8">
			<section class="chat-message-wrapper">
				<header class="chat-message-header">
					<div class="cf">
						<div class="status">
							<div class="meta">
								<div class="meta__name">
									{{users[chat_metas[selected].user].first_name | capitalize}}
									{{users[chat_metas[selected].user].last_name | capitalize}}
								</div>
							</div>
							<!-- <div class="form-horizontal">
								<div class="form-group form-group-sm">
									<label class="col-sm-2 control-label">TO</label>
									<div class="col-sm-10">
										<input class="form-control" type="text" placeholder="Enter username">
									</div>
								</div>
							</div> -->
						</div>
					</div>
				</header>
				<section class="chat-message">
					<div ng-if="selected && !messages.length" class="text-center">
						<h3 style="margin-top:25%">Loading <i class="fa fa-spinner fa-pulse"></i></h3>
					</div>
					<div ng-repeat="message in messages">
						<div class="media">
							<div class="media-left" ng-if="users[message.uid].$id!=user.uid">
								<img class="media-object message-author-img" alt="{{users[message.uid].name}}" style="width: 35px; height: 35px;" ng-src="https://placeholdit.imgix.net/~text?txtsize=24&bg=f27373&txtclr=ffffff&txt={{ users[message.uid].first_name | limitTo:1 | uppercase }}&w=50&h=50">
							</div>
							<div class="media-body" ng-class="{'text-right':users[message.uid].$id==user.uid}">
								<!-- <div class="message-author-name">
									{{users[message.uid].first_name | capitalize}} {{users[message.uid].last_name | capitalize}}
								</div>
							-->
							<div class="message-file" ng-if="message.file">

								<img ng-if="message.file.type=='image/jpeg' || message.file.type=='image/png'" ng-src="{{message.file.payload}}" class="img-rounded" width="40%">

								<div ng-if="!(message.file.type=='image/jpeg' || message.file.type=='image/png')" class="message-body">
									<i class="fa fa-paperclip fa-2x"></i> {{message.file.name}}
									<br>
									Size: {{message.file.size | bytes}}
								</div>

							</div>
							<div class="message-body">
								{{message.text}}
							</div>
							<div class="message-time">
								{{message.createdAt | date:'shortTime'}}
							</div>
						</div>
						<div class="media-right" ng-if="users[message.uid].$id==user.uid">
							<img class="media-object message-author-img" alt="{{users[message.uid].name}}" style="width: 35px; height: 35px;" ng-src="https://placeholdit.imgix.net/~text?txtsize=24&bg=f27373&txtclr=ffffff&txt={{ users[message.uid].first_name | limitTo:1 | uppercase }}&w=50&h=50">
						</div>
					</div>
				</div>
			</section>
			<footer class="chat-send-message">
				<form>
					<fieldset>
						<div class="form-group" style="margin-bottom:5px">
							<textarea class="form-control" rows="3" placeholder="Write a message..."  ng-model="newMessage">
							</textarea>
						</div>
						<!-- <input type="file" id="file"> -->
						<div class="text-right">
							<button class='btn btn-default btn-file-select'>
								<i class="fa fa-paperclip"></i>
								<input type="file" id="file" name="upload"/>
							</button>
							<button class="text-right btn btn-default" role="button"  ng-click="selected && sendMessage(newMessage,selected);newMessage = null;" ng-class="{'disabled':(!selected || !newMessage)}">
								Send Message
							</button>
						</div>
					</fieldset>
				</form>
			</footer>
		</section>
	</div>
</div>
</div>